
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>stlab.utils.stlabdict &#8212; STLab  documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">STLab  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for stlab.utils.stlabdict</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module providing data structures for data collection and analysis</span>

<span class="sd">The main features provided in this module are the stlabmtx class and the stlabdict class as</span>
<span class="sd">well as the framearr_to_mtx function.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">ndimage</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">import</span> <span class="n">gaussian_filter</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>


<div class="viewcode-block" id="stlabdict"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict">[docs]</a><span class="k">class</span> <span class="nc">stlabdict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to hold a data table with multiple lines and columns</span>

<span class="sd">    This class is DEPRECATED in favor of pandas DataFrame.  They serve the same</span>
<span class="sd">    function as an stlabdict but have much more functionality (and documentation...).</span>

<span class="sd">    This class is essentialy an ordered_dict (is a child of) with a few </span>
<span class="sd">    convenience methods included.  Each element of the dict has an index that </span>
<span class="sd">    labels the column and contains an array of numbers with the column data.</span>
<span class="sd">    It is basically a matrix where the column index are string constants instead</span>
<span class="sd">    of numbers (to more explicitly keep track or what each column contains).</span>
<span class="sd">    Can also be indexed by column number.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="stlabdict.__init__"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Init method for stlabdict</span>

<span class="sd">        Simply calls the ordered_dict constructor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">stlabdict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabdict.addparcolumn"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.addparcolumn">[docs]</a>    <span class="k">def</span> <span class="nf">addparcolumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">colname</span><span class="p">,</span><span class="n">colval</span><span class="p">):</span> <span class="c1">#adds a column to </span>
        <span class="sd">&quot;&quot;&quot;Adds a parameter column</span>

<span class="sd">        A parameter column is typically a column with a constant value for all lines (i.e. power in a vna trace).</span>
<span class="sd">        Simply repeats the same value in an array of the same length as the other columns.  Does not work</span>
<span class="sd">        if there are no existing columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        colname : str</span>
<span class="sd">            Column title for the new parameter column</span>
<span class="sd">        colval : float</span>
<span class="sd">            Value to fill the parameter column</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">colval</span><span class="p">)</span>
        <span class="k">return</span></div>
<div class="viewcode-block" id="stlabdict.line"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.line">[docs]</a>    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets a line from the table</span>

<span class="sd">        Takes a line from the stlabdict given by index.  While getting a column can be done by </span>
<span class="sd">        simply taking mystlabdict[myindex], getting a line requires iterating over the dict and</span>
<span class="sd">        pulling out the desired line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nn : int</span>
<span class="sd">            Line number to be extracted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : stlabdict</span>
<span class="sd">            New stlabdict with only the desired line (each element is labelled by the same column</span>
<span class="sd">            name as before but only contains a single float in each).        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">stlabdict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span></div>
<div class="viewcode-block" id="stlabdict.__getitem__"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overloaded indexing of the dict</span>

<span class="sd">        Reimplements the getting of items from the dict to allow for indexing by column position as well</span>
<span class="sd">        as by label</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str or int</span>
<span class="sd">            Desired column index or position.  If a int is given, the method first checks if it is already an</span>
<span class="sd">            index.  If it is not, it returns the column given by the index position.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">stlabdict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">key</span><span class="p">,</span> <span class="nb">int</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">key</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span></div>
<div class="viewcode-block" id="stlabdict.ncol"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.ncol">[docs]</a>    <span class="k">def</span> <span class="nf">ncol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of columns</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of columnms in stlabdict</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>
<div class="viewcode-block" id="stlabdict.nline"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.nline">[docs]</a>    <span class="k">def</span> <span class="nf">nline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of lines in dict</span>

<span class="sd">        Checks that all columns have the same number of lines</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of lines in first column (should be the same for any column)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Columns with different length!!?&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span></div>
<div class="viewcode-block" id="stlabdict.matrix"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabdict.matrix">[docs]</a>    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts entire table into a numpy matrix.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.matrix</span>
<span class="sd">            Matrix containing the same data as the stlabdict.  Loses column titles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mat</span></div></div>
            

<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1">#Auxiliary processing functions for stlabmtx</span>

<div class="viewcode-block" id="checkEqual1"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.checkEqual1">[docs]</a><span class="k">def</span> <span class="nf">checkEqual1</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if all elements in iterator are equal or is empty</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if iterator empty or has the same value for all elements.  False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">first</span> <span class="o">==</span> <span class="n">rest</span> <span class="k">for</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">)</span></div>

<div class="viewcode-block" id="dictarr_to_mtx"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.dictarr_to_mtx">[docs]</a><span class="k">def</span> <span class="nf">dictarr_to_mtx</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rangex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rangey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ykey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ztitle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts an array of dicts (or stlabdicts) to an stlabmtx object</span>

<span class="sd">    Takes an array of dict-like (dict, OrderedDict, stlabdict), typically from a measurement file, and selects the appropriate columns for</span>
<span class="sd">    conversion into an stlabmtx that allows spyview like operations and processing.</span>
<span class="sd">    </span>
<span class="sd">    If neither ranges or titles are given, some defaults are filled in.  The chosen data column from each data array element will be placed</span>
<span class="sd">    as a line in the final matrix sequentially.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array of dict</span>
<span class="sd">        Input array of data dicts.  The dicts are expected to contain a series of arrays of floats with the same length.</span>
<span class="sd">    key : str</span>
<span class="sd">        Index of the appropriate column of each dict for the data axis of the final matrix (data values for each pixel)</span>
<span class="sd">    xkey, ykey : str or None, optional</span>
<span class="sd">        Columns to use to calculate the desired x and y ranges for the final matrix.  If these are proviced they are also</span>
<span class="sd">        used as the x and y titles.  x runs across the matrix columns and y along the rows.  This means that if x is the &quot;slow&quot; variable </span>
<span class="sd">        in the measurement file, the output matrix will be transposed to accomodate this.  The ranges are assumed to be the same for all lines.</span>
<span class="sd">    rangex, rangey : array of float or None, optional</span>
<span class="sd">        If provided, they override the xkey and ykey assingnment.  They should contain arrays of the correct length for use</span>
<span class="sd">        on the axes.  These ranges will be saved along with the data (can be unevenly spaced).  The ranges are assumed to be the same for all lines.</span>
<span class="sd">    xtitle, ytitle, ztitle : str or None, optional</span>
<span class="sd">        Titles for the x, y and z axes.  If provided, they override the titles provided in xkey, ykey and key.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    stlabmtx</span>
<span class="sd">        Resulting stlabmtx.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Build initial matrix.  Appends each data column as line in zz    </span>
    <span class="n">zz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="c1">#convert to np matrix</span>
    <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ztitle</span><span class="p">:</span>
        <span class="n">ztitle</span> <span class="o">=</span> <span class="n">key</span>

    <span class="c1">#No keys or ranges given:</span>
    <span class="k">if</span> <span class="n">rangex</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">xkey</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#If ranges but no keys are given</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">xkey</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rangex</span> <span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">rangex</span><span class="p">,</span> <span class="n">rangey</span><span class="p">,</span> <span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#If keys but no ranges given</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">xkey</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rangex</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#Take first dataset and extract the two relevant columns</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">ykey</span><span class="p">]</span>
        <span class="c1">#Check which is slow (one with all equal values is slow)</span>
        <span class="n">xslow</span><span class="p">,</span><span class="n">yslow</span> <span class="o">=</span> <span class="p">(</span><span class="n">checkEqual1</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span><span class="n">checkEqual1</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
        <span class="c1">#Both can not be fast or slow</span>
        <span class="k">if</span> <span class="n">xslow</span> <span class="o">==</span> <span class="n">yslow</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dictarr_to_mtx: Warning, invalid xkey and ykey.  Using defaults&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
            <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
            <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>
        <span class="c1">#if x is slow, matrix needs to be transposed</span>
        <span class="k">if</span> <span class="n">xslow</span><span class="p">:</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="n">zz</span><span class="o">.</span><span class="n">T</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">xkey</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#Case of y slow</span>
        <span class="c1">#if y is slow, matrix is already correct</span>
        <span class="k">if</span> <span class="n">yslow</span><span class="p">:</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">ykey</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="c1">#Sort out titles</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xkey</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="n">xkey</span> <span class="c1">#Default title</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xkey</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="n">titles</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ykey</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ytitle</span> <span class="o">=</span> <span class="n">ykey</span> <span class="c1">#Default title</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ykey</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">ytitle</span> <span class="o">=</span> <span class="n">titles</span><span class="p">[</span><span class="n">ykey</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#Mixed cases (one key and one range) are not implemented</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dictarr_to_mtx: Warning, invalid keys and ranges.  Using defaults&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>
    <span class="k">return</span> </div>

<span class="k">def</span> <span class="nf">sub_lbl</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lowp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">highp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=-</span><span class="mf">1e99</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">1e99</span><span class="p">):</span>
    <span class="n">new_mtx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mtx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># for some reason this makes it faster</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">mtx</span><span class="p">:</span>
        <span class="c1"># Find boundaries</span>
        <span class="n">min0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">low_limit</span><span class="p">)</span>
        <span class="n">max0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">high_limit</span><span class="p">)</span>
        <span class="n">crop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">min0</span><span class="o">&lt;=</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;=</span><span class="n">max0</span><span class="p">)</span> <span class="c1"># crop list accordingly</span>
        <span class="c1"># Find upper and lower percentiles and assign truthvalue to elements</span>
        <span class="c1"># This is a major time contributor</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">crop</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sub_lbl: Warning, no values to average&#39;</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">low_thres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">crop</span><span class="p">],</span><span class="n">lowp</span><span class="p">)</span>
            <span class="n">high_thres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">crop</span><span class="p">],</span><span class="mi">100</span><span class="o">-</span><span class="n">highp</span><span class="p">)</span>
            <span class="n">crop2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">low_thres</span><span class="o">&lt;=</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;=</span><span class="n">high_thres</span><span class="p">)</span> <span class="c1"># crop again</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">crop2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sub_lbl: Warning, no values to average&#39;</span><span class="p">)</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">crop2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># Calculate mean of remaining values</span>
        <span class="n">new_mtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">new_mtx</span><span class="p">))</span>

<span class="c1">#Main stlabmtx_pd class</span>
<div class="viewcode-block" id="stlabmtx"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx">[docs]</a><span class="k">class</span> <span class="nc">stlabmtx</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;stlabmtx class for spyview-like operations</span>

<span class="sd">    This class implements a matrix in the form of a pandas DataFrame and contains</span>
<span class="sd">    methods analogous to those present in spyview.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mtx : pandas.DataFrame</span>
<span class="sd">        Original dataframe before any processing.  The dataframe indexes are considered</span>
<span class="sd">        the x and y ranges on the final matrix</span>
<span class="sd">    pmtx : pandas.DataFrame</span>
<span class="sd">        Processed dataframe (filters applied)</span>
<span class="sd">    processlist : array of str</span>
<span class="sd">        List strings specifying the applied filters (in order)</span>
<span class="sd">    xtitle, ytitle, ztitle : str</span>
<span class="sd">        Titles for the x,y and z (data) axes </span>
<span class="sd">    xtitle0, ytitle0, ztitle0 : str</span>
<span class="sd">        Initial Titles for the x,y and z (data) axes (so, in case they are changed, reset can recover them)</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="stlabmtx.__init__"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="s1">&#39;xtitle&#39;</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="s1">&#39;ytitle&#39;</span><span class="p">,</span> <span class="n">ztitle</span> <span class="o">=</span> <span class="s1">&#39;ztitle&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;stlab mtx initialization</span>

<span class="sd">        Takes an input DataFrame and sets up the object</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mtx : pandas.DataFrame</span>
<span class="sd">            Intup Dataframe</span>
<span class="sd">        xtitle, ytitle, ztitle : str</span>
<span class="sd">            Title for x,y and z axes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ytitle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xtitle</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">xtitle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ytitle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ztitle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtitle0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ztitle0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span></div>
<div class="viewcode-block" id="stlabmtx.getextents"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.getextents">[docs]</a>    <span class="k">def</span> <span class="nf">getextents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the extents of the matrix</span>

<span class="sd">        Returns a tuple containing (xmin, xmax, ymin, ymax) from the axis ranges,</span>
<span class="sd">        typically to correctly scale the axes when plotting with matplotlib.pyplot.imshow</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of float</span>
<span class="sd">            Four element tuple containing (xmin,xmax,ymin,ymax)        </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
    <span class="c1"># Functions from spyview</span>
<div class="viewcode-block" id="stlabmtx.absolute"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.absolute">[docs]</a>    <span class="k">def</span> <span class="nf">absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Absolute value filter</span>

<span class="sd">        Applies np.abs to all elements of the matrix.  Process string :code:`abs`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.crop"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.crop">[docs]</a>    <span class="k">def</span> <span class="nf">crop</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">low</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Crop filter</span>

<span class="sd">        Crops data matrix to the given extents.  Process string :code:`crop left,right,up,low`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        left : int or None, optional</span>
<span class="sd">            New first column of cropped array.  If None, is assumed to be the first column of the whole set (no crop)</span>
<span class="sd">        right : int or None, optional</span>
<span class="sd">            New last column of cropped array.  If None, is assumed to be the last column of the whole set (no crop).</span>
<span class="sd">            When given a value, the actual index specified is not included in the crop</span>
<span class="sd">        up : int or None, optional</span>
<span class="sd">            New first row of the cropped array.  If None, is assumed to be the first line of the whole set (no crop)</span>
<span class="sd">            When given a value, the actual index specified is not included in the crop</span>
<span class="sd">        low : int or None, optional</span>
<span class="sd">            New first row of the cropped array.  If None, is assumed to be the last line of the whole set (no crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO check</span>
        <span class="n">valdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span><span class="n">left</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">:</span><span class="n">right</span><span class="p">,</span><span class="s1">&#39;up&#39;</span><span class="p">:</span><span class="n">up</span><span class="p">,</span><span class="s1">&#39;low&#39;</span><span class="p">:</span><span class="n">low</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">valdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">valdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]:</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">valdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">valdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;crop </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">],</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">],</span><span class="n">valdict</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">]))</span></div>
<div class="viewcode-block" id="stlabmtx.flip"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.flip">[docs]</a>    <span class="k">def</span> <span class="nf">flip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flip filter</span>

<span class="sd">        Reverses x and/or y axis.  Process string :code:`flip x,y` (0 is false, 1 is true).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : bool, optional</span>
<span class="sd">            If True, x or y is flipped</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">x</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;flip </span><span class="si">{:d}</span><span class="s1">,</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.log10"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.log10">[docs]</a>    <span class="k">def</span> <span class="nf">log10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log10 filter</span>

<span class="sd">        Applies np.log10 to all elements in the matrix.  Process string :code:`log10`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;log10&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.lowpass"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.lowpass">[docs]</a>    <span class="k">def</span> <span class="nf">lowpass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Low Pass filter</span>

<span class="sd">        Applies a gaussian filter to the data with given pixel widths.  Other filters are yet to be implemented.</span>
<span class="sd">        Process string :code:`lowpass x,y`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x,y : int, optional</span>
<span class="sd">            Width of the filter in the x and y direction</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO implement different filter types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;lowpass </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.neg"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.neg">[docs]</a>    <span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Negative filter</span>

<span class="sd">        Multiplies matrix by -1.  Process string :code:`neg`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;neg&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.offset"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.offset">[docs]</a>    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Offset filter</span>

<span class="sd">        Offsets data values by adding given value.  Process string :code:`offset x`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float, optional</span>
<span class="sd">            Value to add to all data values</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">+</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;offset </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.offset_axes"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.offset_axes">[docs]</a>    <span class="k">def</span> <span class="nf">offset_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Axes offset filter</span>

<span class="sd">        Offset axis values.  Process string :code:`offset_axes x,y`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : float, optional</span>
<span class="sd">            Values to add to the axes values of the matrix</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;offset_axes </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.outlier"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.outlier">[docs]</a>    <span class="k">def</span> <span class="nf">outlier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outlier filter</span>
<span class="sd">        </span>
<span class="sd">        Drop a line or column from the data.  Process string :code:`outlier line,vertical`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : int</span>
<span class="sd">            Line or column number to drop</span>
<span class="sd">        vertical : {1,0}, optional</span>
<span class="sd">            If 1, drops a column.  If 0, drops a line</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">vertical</span> <span class="c1">#swap 1 and 0 since vertical axis is 0 and horizontal is 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;outlier </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">vertical</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.pixel_avg"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.pixel_avg">[docs]</a>    <span class="k">def</span> <span class="nf">pixel_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ny</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pixel average filter</span>
<span class="sd">        </span>
<span class="sd">        Performs pixel averaging on matrix.  Process string :code:`pixel_avg nx,ny,center`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nx,ny : int, optional</span>
<span class="sd">            Width and height of averaging window</span>
<span class="sd">        center : {0,1}, optional</span>
<span class="sd">            I don&#39;t know what this does...</span>
<span class="sd">            Looks like it omits the center point of each averaging window from the average?</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span><span class="p">);</span> <span class="n">ny</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">center</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generic_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span><span class="n">cval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>
            <span class="n">mask</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generic_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pixel_avg </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">center</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.rotate_ccw"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.rotate_ccw">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_ccw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotate counter-clockwise filter</span>

<span class="sd">        Rotates matrix and axes counter-clockwise.  Process string :code:`rotate_ccw`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rotate_ccw&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.rotate_cw"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.rotate_cw">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_cw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotate clockwise filter</span>

<span class="sd">        Rotates matrix and axes clockwise.  Process string :code:`rotate_cw`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rotate_cw&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.scale_data"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.scale_data">[docs]</a>    <span class="k">def</span> <span class="nf">scale_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale filter</span>

<span class="sd">        Scales all data by given factor.  Process string :code:`scale x`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor : float, optional</span>
<span class="sd">            Value to scale the data by</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scale </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">factor</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.sub_lbl"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.sub_lbl">[docs]</a>    <span class="k">def</span> <span class="nf">sub_lbl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lowp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">highp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=-</span><span class="mf">1e99</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">1e99</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Substract line by line filter</span>

<span class="sd">        The average value of each line is substracted from the data.  Parts of each line cut can be</span>
<span class="sd">        excluded using the high and low percentile options.  The idea is that all points are sorted in</span>
<span class="sd">        increasing order and a percentage from the back and front of the list is rejected for the average</span>
<span class="sd">        calculation.  Process string :code:`sub_lbl lowp,highp,low_limit,high_limit`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lowp : float</span>
<span class="sd">            Percentage of points to be rejected from the averaging on the low side.</span>
<span class="sd">        highp : float</span>
<span class="sd">            Percentage of points to be rejected from the averaging on the high side.</span>
<span class="sd">        low_limit : float</span>
<span class="sd">            Absolute value below which points are ignored for the average (and percentile calculations)</span>
<span class="sd">        low_limit : float</span>
<span class="sd">            Absolute value above which points are ignored for the average (and percentile calculations)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">sub_lbl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">lowp</span><span class="p">,</span><span class="n">highp</span><span class="p">,</span><span class="n">low_limit</span><span class="p">,</span><span class="n">high_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sub_lbl </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lowp</span><span class="p">,</span><span class="n">highp</span><span class="p">,</span><span class="n">low_limit</span><span class="p">,</span><span class="n">high_limit</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.sub_cbc"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.sub_cbc">[docs]</a>    <span class="k">def</span> <span class="nf">sub_cbc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lowp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">highp</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">low_limit</span><span class="o">=-</span><span class="mf">1e99</span><span class="p">,</span> <span class="n">high_limit</span><span class="o">=</span><span class="mf">1e99</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Subtract column by column filter</span>
<span class="sd">    </span>
<span class="sd">        Same as :any:`sub_lbl` but done on a column by column basis.  Process string :code:`sub_cbc lowp,highp,low_limit,high_limit`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">sub_lbl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">lowp</span><span class="p">,</span><span class="n">highp</span><span class="p">,</span><span class="n">low_limit</span><span class="p">,</span><span class="n">high_limit</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sub_cbc </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lowp</span><span class="p">,</span><span class="n">highp</span><span class="p">,</span><span class="n">low_limit</span><span class="p">,</span><span class="n">high_limit</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.sub_linecut"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.sub_linecut">[docs]</a>    <span class="k">def</span> <span class="nf">sub_linecut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract lincut filter</span>

<span class="sd">        Selects a line or column and subtracts it from all othe lines or columns in the matrix.</span>
<span class="sd">        Process string :code:`sub_linecut pos,horizontal`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : int</span>
<span class="sd">            Index of line or column to be subtracted</span>
<span class="sd">        horizontal : {1,0}</span>
<span class="sd">            If 1, a line is subtrcted.  If 0 a column is subtracted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">horizontal</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">pos</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">pos</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sub_linecut </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">horizontal</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.vi_to_iv"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.vi_to_iv">[docs]</a>    <span class="k">def</span> <span class="nf">vi_to_iv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">nbins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;vi to iv filter</span>

<span class="sd">        Reverses the data axis with the y axis of the matrix.  For example, if the data contains the voltage and the axis the current</span>
<span class="sd">        this filter replaces the voltage data with the corresponding current data and the axis with the voltage (I think...).</span>
<span class="sd">        Since the axes are expected to be ordered, this is not an immediate operation and may not be possible in many cases (repeated data values?).</span>

<span class="sd">        If one desires to do this with the x axis instead of the y, the matrix must first be transposed.  After the filter is applied the transpose</span>
<span class="sd">        can be undone.</span>

<span class="sd">        Process string :code:`vi_to_iv vmin,vmax,nbins`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vmin : float</span>
<span class="sd">            Lower end of the new y axis</span>
<span class="sd">        vmax : float</span>
<span class="sd">            Upper end of the new y axis</span>
<span class="sd">        nbins : int</span>
<span class="sd">            Number of points in the new axis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vinterpol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
        <span class="n">pmtx</span> <span class="o">=</span> <span class="p">[</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">[</span><span class="n">column</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)(</span><span class="n">vinterpol</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmtx</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">vinterpol</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vi_to_iv </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">nbins</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.xderiv"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.xderiv">[docs]</a>    <span class="k">def</span> <span class="nf">xderiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;X derivative filter</span>

<span class="sd">        Apply a derivative along the lines of the matrix.  Process string :code:`xderiv direction`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        direction : {1,-1}</span>
<span class="sd">            Direction for derivative.  1 by default (normal diff derivative)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">xderiv_pd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">,</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;xderiv </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.yderiv"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.yderiv">[docs]</a>    <span class="k">def</span> <span class="nf">yderiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Y derivative filter</span>

<span class="sd">        Apply a derivative along the columns of the matrix.  Process string :code:`yderiv direction`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        direction : {1,-1}</span>
<span class="sd">            Direction for derivative.  1 by default (normal diff derivative)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="n">yderiv_pd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="p">,</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;yderiv </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span></div>
<div class="viewcode-block" id="stlabmtx.transpose"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.transpose">[docs]</a>    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transpose filter</span>

<span class="sd">        Transposes the data matrix (and axes).  Process string :code:`transpose`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;transpose&#39;</span><span class="p">)</span></div>

    <span class="c1"># Processlist</span>
<div class="viewcode-block" id="stlabmtx.saveprocesslist"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.saveprocesslist">[docs]</a>    <span class="k">def</span> <span class="nf">saveprocesslist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;./process.pl&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save applied filter list</span>

<span class="sd">        Saves the applied filters and parameters to a text file (process.pl in the current folder by default)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the new file to save the list in.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="p">:</span>
            <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="stlabmtx.applystep"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.applystep">[docs]</a>    <span class="k">def</span> <span class="nf">applystep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply step from a process list string</span>

<span class="sd">        Takes in input string descibing one filter application and applies it to the data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : str</span>
<span class="sd">            String describing the desired filter to be applied</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">]</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">pars</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">pars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>
<div class="viewcode-block" id="stlabmtx.applyprocesslist"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.applyprocesslist">[docs]</a>    <span class="k">def</span> <span class="nf">applyprocesslist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply all steps in array of process strings</span>

<span class="sd">        Takes in input list of strings descibing filters to be applied to the data and runs them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : str</span>
<span class="sd">            String describing the desired filter to be applied</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applystep</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.applyprocessfile"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.applyprocessfile">[docs]</a>    <span class="k">def</span> <span class="nf">applyprocessfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply all steps in a process list file</span>

<span class="sd">        Takes in input file containing a process list and applies them to the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Process file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="o">==</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">applystep</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.reset"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset filters</span>

<span class="sd">        Resets all filters and returns matrix to its initial state</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytitle0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span></div>
<div class="viewcode-block" id="stlabmtx.delstep"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.delstep">[docs]</a>    <span class="k">def</span> <span class="nf">delstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ii</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a filter from the current process list by index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ii : int</span>
<span class="sd">            Index of filter to be removed from applied filters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newpl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">newpl</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyprocesslist</span><span class="p">(</span><span class="n">newpl</span><span class="p">)</span></div>
<div class="viewcode-block" id="stlabmtx.insertstep"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.insertstep">[docs]</a>    <span class="k">def</span> <span class="nf">insertstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inserts new filter into process list</span>

<span class="sd">        Adds a new filter at a specific position in the process list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ii : int</span>
<span class="sd">            Index for the position of the new filter</span>
<span class="sd">        line : str</span>
<span class="sd">            Process string for the new filter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newpl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processlist</span><span class="p">)</span>
        <span class="n">newpl</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyprocesslist</span><span class="p">(</span><span class="n">newpl</span><span class="p">)</span></div>

    <span class="c1">#Uses pickle to save to file</span>
<div class="viewcode-block" id="stlabmtx.save"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save matrix to file</span>

<span class="sd">        Pickels the object and saves it to given file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Base filename to be used.  &quot;.mtx.pkl&quot; will be appended to given filename</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.mtx.pkl&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span></div>
    <span class="c1">#To load:</span>
    <span class="c1">#import pickle</span>
    <span class="c1">#with open(filename, &#39;rb&#39;) as input:</span>
    <span class="c1">#   mtx1 = pickle.load(input)</span>

<div class="viewcode-block" id="stlabmtx.savemtx"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.savemtx">[docs]</a>    <span class="k">def</span> <span class="nf">savemtx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;./output&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save to Spyview mtx format</span>

<span class="sd">        Saves current processed matrix to a spyview mtx file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the new mtx file.  &quot;.mtx&quot; will be appended.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.mtx&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">ztitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ztitle</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span><span class="n">ztitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xtitle</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;</span><span class="si">{:e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ytitle</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;</span><span class="si">{:e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;Nothing&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">mystr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39;1 8</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">mystr</span><span class="p">,</span> <span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmtx</span><span class="o">.</span><span class="n">values</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<span class="c1">#           Units, Data Value ,Y, 0.000000e+00, 2.001000e+03,Z, 0.000000e+00, 6.010000e+02,Nothing, 0, 1</span>
<span class="c1">#           2001 601 1 8</span>

            <span class="c1">#Units, Dataset name, xname, xmin, xmax, yname, ymin, ymax, zname, zmin, zmax</span>
            <span class="c1">#nx ny nz length</span>

            <span class="c1">#dB, S21dB, Frequency (Hz), 6.000000e+09, 8.300000e+09, Vgate (V), 3.000000e+01, -3.000000e+01, Nothing, 0, 1</span>
            <span class="c1">#2001 601 1 8</span>

<div class="viewcode-block" id="stlabmtx.loadmtx"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.stlabmtx.loadmtx">[docs]</a>    <span class="k">def</span> <span class="nf">loadmtx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load matrix from an existing Spyview mtx file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Name of the mtx file to open</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">content</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Units&#39;</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ztitle0</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xtitle0</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ytitle0</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">xlow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">xhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">ylow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">yhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">lb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">rangex0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlow</span><span class="p">,</span><span class="n">xhigh</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
                <span class="n">rangey0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylow</span><span class="p">,</span><span class="n">yhigh</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">lb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">rangex0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
                <span class="n">rangey0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">ny</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lb</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">,(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">),</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rangex0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">rangey0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div></div>

<span class="n">stlabmtx_pd</span> <span class="o">=</span> <span class="n">stlabmtx</span>


<span class="k">def</span> <span class="nf">yderiv_pd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">direction</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="n">dy</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">xderiv_pd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">yderiv_pd</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">direction</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>



<div class="viewcode-block" id="framearr_to_mtx"><a class="viewcode-back" href="../../../utils/stlabdict.html#stlab.utils.stlabdict.framearr_to_mtx">[docs]</a><span class="k">def</span> <span class="nf">framearr_to_mtx</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rangex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rangey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ykey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ztitle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts an array of pandas DataFrame to an stlabmtx object</span>

<span class="sd">    Takes an array of pandas.DataFrame, typically from a measurement file, and selects the appropriate columns for</span>
<span class="sd">    conversion into an stlabmtx that allows spyview like operations and processing.  Is essentially the same as :any:`dictarr_to_mtx`</span>
<span class="sd">    but adapted for pandas DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    If neither ranges or titles are given, some defaults are filled in.  The chosen data column from each data array element will be placed</span>
<span class="sd">    as a line in the final matrix sequentially.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array of dict</span>
<span class="sd">        Input array of frames.</span>
<span class="sd">    key : str</span>
<span class="sd">        Index of the appropriate column of each frame for the data axis of the final matrix (data values for each pixel)</span>
<span class="sd">    xkey, ykey : str or None, optional</span>
<span class="sd">        Columns to use to calculate the desired x and y ranges for the final matrix.  If these are proviced they are also</span>
<span class="sd">        used as the x and y titles.  x runs across the matrix columns and y along the rows.  This means that if x is the &quot;slow&quot; variable </span>
<span class="sd">        in the measurement file, the output matrix will be transposed to accomodate this.  The ranges are assumed to be the same for all lines.</span>
<span class="sd">    rangex, rangey : array of float or None, optional</span>
<span class="sd">        If provided, they override the xkey and ykey assingnment.  They should contain arrays of the correct length for use</span>
<span class="sd">        on the axes.  These ranges will be saved along with the data (can be unevenly spaced).  The ranges are assumed to be the same for all lines.</span>
<span class="sd">    xtitle, ytitle, ztitle : str or None, optional</span>
<span class="sd">        Titles for the x, y and z axes.  If provided, they override the titles provided in xkey, ykey and key.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    stlabmtx</span>
<span class="sd">        Resulting stlabmtx.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Build initial matrix.  Appends each data column as line in zz    </span>
    <span class="n">zz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="c1">#convert to np matrix</span>
    <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ztitle</span><span class="p">:</span>
        <span class="n">ztitle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1">#No keys or ranges given:</span>
    <span class="k">if</span> <span class="n">rangex</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">xkey</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#If ranges but no keys are given</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">xkey</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rangex</span> <span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">rangey</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="n">rangex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#If keys but no ranges given</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">xkey</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ykey</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rangex</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rangey</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#Take first dataset and extract the two relevant columns</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">ykey</span><span class="p">]</span>
        <span class="c1">#Check which is slow (one with all equal values is slow)</span>
        <span class="n">xslow</span><span class="p">,</span><span class="n">yslow</span> <span class="o">=</span> <span class="p">(</span><span class="n">checkEqual1</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span><span class="n">checkEqual1</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
        <span class="c1">#Both can not be fast or slow</span>
        <span class="k">if</span> <span class="n">xslow</span> <span class="o">==</span> <span class="n">yslow</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dictarr_to_mtx: Warning, invalid xkey and ykey.  Using defaults&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
            <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
            <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>
        <span class="c1">#if x is slow, matrix needs to be transposed</span>
        <span class="k">if</span> <span class="n">xslow</span><span class="p">:</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="n">zz</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1">#Case of y slow</span>
        <span class="c1">#if x is slow, matrix is already correct</span>
        <span class="k">if</span> <span class="n">yslow</span><span class="p">:</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">ykey</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="c1">#Sort out titles</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ykey</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ykey</span><span class="p">)</span> <span class="c1">#Default title</span>

        <span class="n">zz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
        <span class="n">zz</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">yy</span>
        <span class="n">zz</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">xx</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>

    <span class="c1">#Mixed cases (one key and one range) are not implemented</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dictarr_to_mtx: Warning, invalid keys and ranges.  Using defaults&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xtitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="s1">&#39;xtitle&#39;</span> <span class="c1">#Default title</span>
        <span class="k">if</span> <span class="n">ytitle</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ytitle</span> <span class="o">=</span> <span class="s1">&#39;ytitle&#39;</span> <span class="c1">#Default title</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">stlabmtx</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">xtitle</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="n">ytitle</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="n">ztitle</span><span class="p">)</span>
    <span class="k">return</span></div>





<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def xderiv(data,rangex,direction=1,axis=1):</span>
<span class="sd">    dx = np.abs(rangex[0]-rangex[1])</span>
<span class="sd">    if direction==-1:</span>
<span class="sd">        dx = -dx</span>
<span class="sd">    z = np.squeeze(np.array(data))</span>
<span class="sd">    dz = np.gradient(z, dx, axis=axis)    </span>
<span class="sd">    return np.matrix(np.squeeze(dz))</span>
<span class="sd">&#39;&#39;&#39;</span>
 
<span class="c1"># Use slow if spacing is non-uniform</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def xderiv_slow(data,rangex,direction=1):</span>
<span class="sd">    mtx = data</span>
<span class="sd">    new_mtx = []</span>
<span class="sd">    if direction==-1:</span>
<span class="sd">        x = rangex[::-1]</span>
<span class="sd">    else:</span>
<span class="sd">        x = rangex</span>
<span class="sd">    for line in data:</span>
<span class="sd">        z = np.squeeze(np.array(line))</span>
<span class="sd">        dz = np.zeros(x.shape,np.float)</span>
<span class="sd">        dz[0:-1] = np.diff(z)/np.diff(x)</span>
<span class="sd">        dz[-1] = (z[-1] - z[-2])/(x[-1] - x[-2])</span>
<span class="sd">        new_mtx.append(dz)</span>
<span class="sd">    return np.matrix(new_mtx)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="c1">#Main stlabmtx class</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">class stlabmtx():</span>
<span class="sd">    def __init__(self, mtx=np.zeros([0,0]), rangex=None, rangey=None, xtitle=&#39;xtitle&#39;, ytitle=&#39;ytitle&#39;, ztitle = &#39;ztitle&#39;):</span>
<span class="sd">        self.mtx = np.matrix(copy.deepcopy(mtx))</span>
<span class="sd">        print(self.mtx.shape)</span>
<span class="sd">        self.processlist = []</span>
<span class="sd">        self.pmtx = self.mtx</span>
<span class="sd">        if rangex is None:</span>
<span class="sd">            self.rangex = np.arange(self.mtx.shape[1])</span>
<span class="sd">        else:</span>
<span class="sd">            self.rangex = np.asarray(rangex)</span>
<span class="sd">        if rangey is None:</span>
<span class="sd">            self.rangey = np.arange(self.mtx.shape[0])</span>
<span class="sd">        else:</span>
<span class="sd">            self.rangey = np.asarray(rangey)</span>
<span class="sd">        self.xtitle=str(xtitle)</span>
<span class="sd">        self.ytitle=str(ytitle)</span>
<span class="sd">        self.ztitle = str(ztitle)</span>
<span class="sd">        self.xtitle0=self.xtitle</span>
<span class="sd">        self.ytitle0=self.ytitle</span>
<span class="sd">        self.ztitle0=self.ztitle</span>
<span class="sd">        self.rangex0 = self.rangex</span>
<span class="sd">        self.rangey0 = self.rangey</span>
<span class="sd">    def getextents(self):</span>
<span class="sd">        return (self.rangex[0],self.rangex[-1],self.rangey[-1],self.rangey[0])</span>
<span class="sd">    # Functions from spyview</span>
<span class="sd">    def absolute(self):</span>
<span class="sd">        self.pmtx = abs(self.pmtx)</span>
<span class="sd">        self.processlist.append(&#39;abs&#39;)</span>
<span class="sd">    def crop(data,left=None,right=None,up=None,low=None):</span>
<span class="sd">        #TODO check</span>
<span class="sd">        valdict={&#39;left&#39;:left,&#39;right&#39;:right,&#39;up&#39;:up,&#39;low&#39;:low}</span>
<span class="sd">        for key,val in valdict.items():</span>
<span class="sd">            if val==0:</span>
<span class="sd">                valdict[key] = None</span>
<span class="sd">            else:</span>
<span class="sd">                valdict[key] = int(val)</span>
<span class="sd">        data.pmtx = data.pmtx[valdict[&#39;left&#39;]:valdict[&#39;right&#39;],valdict[&#39;up&#39;]:valdict[&#39;low&#39;]]</span>
<span class="sd">        data.rangex = data.rangex[valdict[&#39;up&#39;]:valdict[&#39;low&#39;]]</span>
<span class="sd">        data.rangey = data.rangey[valdict[&#39;left&#39;]:valdict[&#39;right&#39;]]</span>
<span class="sd">        for key,val in valdict.items():</span>
<span class="sd">            if val==None:</span>
<span class="sd">                valdict[key] = 0</span>
<span class="sd">        data.processlist.append(&#39;crop {},{},{},{}&#39;.format(valdict[&#39;left&#39;],valdict[&#39;right&#39;],valdict[&#39;up&#39;],valdict[&#39;low&#39;]))</span>
<span class="sd">    def flip(self,x=False,y=False):</span>
<span class="sd">        x=bool(x)</span>
<span class="sd">        y=bool(y)</span>
<span class="sd">        if x:</span>
<span class="sd">            self.pmtx = np.fliplr(self.pmtx)</span>
<span class="sd">            self.rangex = self.rangex[::-1]</span>
<span class="sd">        if y:</span>
<span class="sd">            self.pmtx = np.flipud(self.pmtx)</span>
<span class="sd">            self.rangey = self.rangey[::-1]</span>
<span class="sd">        self.processlist.append(&#39;flip {:d},{:d}&#39;.format(x,y))</span>
<span class="sd">    def log10(self):</span>
<span class="sd">        self.pmtx = np.log10(self.pmtx)</span>
<span class="sd">        self.processlist.append(&#39;log10&#39;)</span>
<span class="sd">    def lowpass(self,x=0,y=0):</span>
<span class="sd">        # TODO implement different filter types</span>
<span class="sd">        self.pmtx = np.matrix(gaussian_filter(np.squeeze(np.asarray(self.pmtx)),sigma=[int(y),int(x)]))</span>
<span class="sd">        self.processlist.append(&#39;lowpass {},{}&#39;.format(x,y))</span>
<span class="sd">    def neg(self):</span>
<span class="sd">        self.pmtx = -self.pmtx</span>
<span class="sd">        self.processlist.append(&#39;neg&#39;)</span>
<span class="sd">    def offset(self,x=0):</span>
<span class="sd">        self.pmtx = self.pmtx + x</span>
<span class="sd">        self.processlist.append(&#39;offset {}&#39;.format(x))</span>
<span class="sd">    def offset_axes(self,x=0,y=0):</span>
<span class="sd">        self.rangex+=x</span>
<span class="sd">        self.rangey+=y</span>
<span class="sd">        self.processlist.append(&#39;offset_axes {},{}&#39;.format(x,y))</span>
<span class="sd">    def outlier(self,line,vertical=1):</span>
<span class="sd">        self.pmtx = np.delete(self.pmtx,line,axis=int(vertical))</span>
<span class="sd">        if bool(vertical):</span>
<span class="sd">            self.rangex = np.delete(self.rangex, line)</span>
<span class="sd">        else:</span>
<span class="sd">            self.rangey = np.delete(self.rangey, line)</span>
<span class="sd">        self.processlist.append(&#39;outlier {},{}&#39;.format(line,vertical))</span>
<span class="sd">    def pixel_avg(self,nx=0,ny=0,center=0):</span>
<span class="sd">        nx=int(nx); ny=int(ny)</span>
<span class="sd">        if bool(center):</span>
<span class="sd">            self.pmtx = ndimage.generic_filter(self.pmtx, np.nanmean, size=(nx,ny), mode=&#39;constant&#39;,cval=np.NaN)</span>
<span class="sd">        else:</span>
<span class="sd">            mask = np.ones((nx, ny))</span>
<span class="sd">            mask[int(nx/2), int(ny/2)] = 0</span>
<span class="sd">            self.pmtx = ndimage.generic_filter(self.pmtx, np.nanmean, footprint=mask, mode=&#39;constant&#39;, cval=np.NaN)</span>
<span class="sd">        self.processlist.append(&#39;pixel_avg {},{},{}&#39;.format(nx,ny,center))</span>
<span class="sd">    def rotate_ccw(self):</span>
<span class="sd">        # still lacking the switching of the axes</span>
<span class="sd">        self.pmtx = np.rot90(self.pmtx)</span>
<span class="sd">        self.processlist.append(&#39;rotate_ccw&#39;)</span>
<span class="sd">        self.xtitle, self.ytitle = self.ytitle, self.xtitle</span>
<span class="sd">        self.rangex , self.rangey = self.rangey, self.rangex[::-1]</span>
<span class="sd">    def rotate_cw(self):</span>
<span class="sd">        # still lacking the switching of the axes</span>
<span class="sd">        self.pmtx = np.rot90(self.pmtx,3)</span>
<span class="sd">        self.processlist.append(&#39;rotate_cw&#39;)</span>
<span class="sd">        self.xtitle, self.ytitle = self.ytitle, self.xtitle</span>
<span class="sd">        self.rangex , self.rangey = self.rangey[::-1], self.rangex</span>
<span class="sd">    def scale_data(self,factor=1.):</span>
<span class="sd">        self.pmtx = factor*self.pmtx</span>
<span class="sd">        self.processlist.append(&#39;scale {}&#39;.format(factor))</span>
<span class="sd">    def sub_lbl(self,lowp=40, highp=40, low_limit=-1e99, high_limit=1e99):</span>
<span class="sd">        self.pmtx = sub_lbl(self.pmtx,lowp,highp,low_limit,high_limit)</span>
<span class="sd">        self.processlist.append(&#39;sub_lbl {},{},{},{}&#39;.format(lowp,highp,low_limit,high_limit))</span>
<span class="sd">    def sub_cbc(self,lowp=40, highp=40, low_limit=-1e99, high_limit=1e99):</span>
<span class="sd">        self.pmtx = sub_lbl(self.pmtx.T,lowp,highp,low_limit,high_limit).T</span>
<span class="sd">        self.processlist.append(&#39;sub_cbc {},{},{},{}&#39;.format(lowp,highp,low_limit,high_limit))</span>
<span class="sd">    def sub_linecut(self, pos, horizontal=1):</span>
<span class="sd">        pos = int(pos)</span>
<span class="sd">        if bool(horizontal):</span>
<span class="sd">            v = self.pmtx[pos,:]</span>
<span class="sd">            self.pmtx-=v</span>
<span class="sd">        else:</span>
<span class="sd">            v = self.pmtx[:,pos].T</span>
<span class="sd">            mtx = self.pmtx.T - v</span>
<span class="sd">            self.pmtx = mtx.T</span>
<span class="sd">        self.processlist.append(&#39;sub_linecut {},{}&#39;.format(pos,horizontal))</span>
<span class="sd">    def xderiv(self,direction=1):</span>
<span class="sd">        mtx = self.pmtx.copy()</span>
<span class="sd">        self.pmtx = xderiv(mtx,self.rangex,direction)</span>
<span class="sd">        self.processlist.append(&#39;xderiv {}&#39;.format(direction))</span>
<span class="sd">    def yderiv(self,direction=1):</span>
<span class="sd">        mtx = self.pmtx.copy()</span>
<span class="sd">        self.pmtx = xderiv(mtx,self.rangey,direction,axis=0)</span>
<span class="sd">        self.processlist.append(&#39;yderiv {}&#39;.format(direction))</span>
<span class="sd">    #Use slow versions for unequally spaced ranges</span>
<span class="sd">    def xderiv_slow(self,direction=1):</span>
<span class="sd">        mtx = self.pmtx.copy()</span>
<span class="sd">        self.pmtx = xderiv(mtx,self.rangex,direction)</span>
<span class="sd">        self.processlist.append(&#39;xderiv_slow {}&#39;.format(direction))</span>
<span class="sd">    def yderiv_slow(self,direction=1):</span>
<span class="sd">        mtx = self.pmtx.copy().T</span>
<span class="sd">        self.pmtx = xderiv(mtx,self.rangey,direction).T</span>
<span class="sd">        self.processlist.append(&#39;yderiv_slow {}&#39;.format(direction))</span>
<span class="sd">    def transpose(self):</span>
<span class="sd">        self.pmtx = self.pmtx.T</span>
<span class="sd">        self.xtitle, self.ytitle = self.ytitle, self.xtitle</span>
<span class="sd">        self.rangex, self.rangey = self.rangey, self.rangex</span>
<span class="sd">        self.processlist.append(&#39;transpose&#39;)</span>
<span class="sd">    </span>
<span class="sd">    # Processlist</span>
<span class="sd">    def saveprocesslist(self,filename = &#39;./process.pl&#39;):</span>
<span class="sd">        myfile = open(filename,&#39;w&#39;)</span>
<span class="sd">        for line in self.processlist:</span>
<span class="sd">            myfile.write(line + &#39;\n&#39;)</span>
<span class="sd">        myfile.close()</span>
<span class="sd">    def applystep(self,line):</span>
<span class="sd">            sline = line.split(&#39; &#39;)</span>
<span class="sd">            if len(sline) == 1:</span>
<span class="sd">                func = sline[0]</span>
<span class="sd">                pars = []</span>
<span class="sd">            else:</span>
<span class="sd">                pars = sline[1].split(&#39;,&#39;)</span>
<span class="sd">                func = sline[0].strip()</span>
<span class="sd">            if func is &#39;&#39;:</span>
<span class="sd">                return</span>
<span class="sd">            else:</span>
<span class="sd">                pars = [float(x) for x in pars]</span>
<span class="sd">            method = getattr(self, func)</span>
<span class="sd">            print(func,pars)</span>
<span class="sd">            method(*pars)</span>
<span class="sd">    def applyprocesslist(self,pl):</span>
<span class="sd">        for line in pl:</span>
<span class="sd">            self.applystep(line)</span>
<span class="sd">    def applyprocessfile(self,filename):</span>
<span class="sd">        with open(filename,&#39;r&#39;) as myfile:</span>
<span class="sd">            for line in myfile:</span>
<span class="sd">                if &#39;#&#39; == line[0]:</span>
<span class="sd">                    continue</span>
<span class="sd">                self.applystep(line)</span>
<span class="sd">    def reset(self):</span>
<span class="sd">        self.processlist = []</span>
<span class="sd">        self.pmtx = self.mtx</span>
<span class="sd">        self.xtitle = self.xtitle0</span>
<span class="sd">        self.ytitle = self.ytitle0</span>
<span class="sd">        self.rangex = self.rangex0</span>
<span class="sd">        self.rangey = self.rangey0</span>
<span class="sd">    def delstep(self,ii):</span>
<span class="sd">        newpl = copy.deepcopy(self.processlist)</span>
<span class="sd">        del newpl[ii]</span>
<span class="sd">        self.reset()</span>
<span class="sd">        self.applyprocesslist(newpl)</span>
<span class="sd">    def insertstep(self,ii,line):</span>
<span class="sd">        newpl = copy.deepcopy(self.processlist)</span>
<span class="sd">        newpl.insert(ii,line)</span>
<span class="sd">        self.reset()</span>
<span class="sd">        self.applyprocesslist(newpl)</span>

<span class="sd">    #Uses pickle to save to file</span>
<span class="sd">    def save(self,name = &#39;output&#39;):</span>
<span class="sd">        filename = name + &#39;.mtx.pkl&#39;</span>
<span class="sd">        with open(filename, &#39;wb&#39;) as outfile:</span>
<span class="sd">            pickle.dump(self,outfile, pickle.HIGHEST_PROTOCOL)</span>
<span class="sd">    #To load:</span>
<span class="sd">    #import pickle</span>
<span class="sd">    #with open(filename, &#39;rb&#39;) as input:</span>
<span class="sd">    #   mtx1 = pickle.load(input)</span>

<span class="sd">    def savemtx(self,filename = &#39;./output&#39;):</span>
<span class="sd">        filename = filename + &#39;.mtx&#39;</span>
<span class="sd">        with open(filename, &#39;wb&#39;) as outfile:</span>
<span class="sd">            ztitle = self.ztitle</span>
<span class="sd">            xx = self.rangex</span>
<span class="sd">            yy = self.rangey</span>
<span class="sd">            line = [&#39;Units&#39;,ztitle, self.xtitle,&#39;{:e}&#39;.format(xx[0]),&#39;{:e}&#39;.format(xx[-1]), self.ytitle,&#39;{:e}&#39;.format(yy[0]),&#39;{:e}&#39;.format(yy[-1]), &#39;Nothing&#39;,str(0),str(1)]</span>
<span class="sd">            mystr = &#39;, &#39;.join(line)</span>
<span class="sd">            mystr = bytes(mystr + &#39;\n&#39;, &#39;ASCII&#39;)</span>
<span class="sd">            outfile.write(mystr)</span>
<span class="sd">            mystr = str(self.pmtx.shape[1]) + &#39; &#39; + str(self.pmtx.shape[0]) + &#39; &#39; + &#39;1 8\n&#39;</span>
<span class="sd">            mystr = bytes(mystr, &#39;ASCII&#39;)</span>
<span class="sd">            outfile.write(mystr)</span>
<span class="sd">            data = self.pmtx</span>
<span class="sd">            data = np.squeeze(np.asarray(np.ndarray.flatten(data,order=&#39;F&#39;)))</span>
<span class="sd">            print(len(data))</span>
<span class="sd">            s = struct.pack(&#39;d&#39;*len(data), *data)</span>
<span class="sd">            outfile.write(s)</span>

<span class="sd">#           Units, Data Value ,Y, 0.000000e+00, 2.001000e+03,Z, 0.000000e+00, 6.010000e+02,Nothing, 0, 1</span>
<span class="sd">#           2001 601 1 8</span>

<span class="sd">            #Units, Dataset name, xname, xmin, xmax, yname, ymin, ymax, zname, zmin, zmax</span>
<span class="sd">            #nx ny nz length</span>

<span class="sd">            #dB, S21dB, Frequency (Hz), 6.000000e+09, 8.300000e+09, Vgate (V), 3.000000e+01, -3.000000e+01, Nothing, 0, 1</span>
<span class="sd">            #2001 601 1 8</span>

<span class="sd">    def loadmtx(self,filename):</span>
<span class="sd">        with open(filename,&#39;rb&#39;) as infile:</span>
<span class="sd">            content = infile.readline()</span>
<span class="sd">            content = content.decode(&#39;ASCII&#39;)</span>
<span class="sd">            if content[:5] == &#39;Units&#39;:</span>
<span class="sd">                content = content.split(&#39;,&#39;)</span>
<span class="sd">                content = [x.strip() for x in content]</span>
<span class="sd">                self.ztitle0 = content[1]</span>
<span class="sd">                self.xtitle0 = content[2]</span>
<span class="sd">                self.ytitle0 = content[5]</span>
<span class="sd">                xlow = np.float64(content[3])</span>
<span class="sd">                xhigh = np.float64(content[4])</span>
<span class="sd">                ylow = np.float64(content[6])</span>
<span class="sd">                yhigh = np.float64(content[7])</span>
<span class="sd">                content = infile.readline()</span>
<span class="sd">                content = content.decode(&#39;ASCII&#39;)</span>
<span class="sd">                content = content.split(&#39; &#39;)</span>
<span class="sd">                nx = int(content[0])</span>
<span class="sd">                ny = int(content[1])</span>
<span class="sd">                lb = int(content[3])</span>
<span class="sd">                self.rangex0 = np.linspace(xlow,xhigh,nx)</span>
<span class="sd">                self.rangey0 = np.linspace(ylow,yhigh,ny)</span>
<span class="sd">            else:</span>
<span class="sd">                content = content.decode(&#39;ASCII&#39;)</span>
<span class="sd">                content = content.split(&#39; &#39;)</span>
<span class="sd">                nx = int(content[0])</span>
<span class="sd">                ny = int(content[1])</span>
<span class="sd">                lb = int(content[3])</span>
<span class="sd">                self.rangex0 = np.linspace(1,nx,nx)</span>
<span class="sd">                self.rangey0 = np.linspace(1,ny,ny)</span>
<span class="sd">            n = nx*ny</span>
<span class="sd">            content = infile.read()</span>
<span class="sd">            if lb == 8:</span>
<span class="sd">                s = struct.unpack(&#39;d&#39;*n, content)</span>
<span class="sd">            elif lb == 4:</span>
<span class="sd">                s = struct.unpack(&#39;f&#39;*n, content)</span>
<span class="sd">            s = np.asarray(s)</span>
<span class="sd">            s = np.matrix(np.reshape(s,(ny,nx),order=&#39;F&#39;))</span>
<span class="sd">            self.mtx = s</span>
<span class="sd">            self.reset()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">STLab  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, GPL3.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>